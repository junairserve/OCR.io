<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>製造番号 紐づけ（OCR）</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="header">
    <h1>製造番号 紐づけ（OCR）</h1>
    <p class="sub">基板番号と本体S/Nを撮影して紐づけ保存します（QR不要）</p>
  </header>

  <main class="container">
    <section class="card">
      <h2>1) 本体銘板を撮影（SN）</h2>
      <div class="row">
        <button id="btnCaptureBody" class="btn primary">📷 本体を撮影</button>
        <button id="btnClearBody" class="btn">クリア</button>
      </div>
      <div class="result">
        <div class="label">抽出結果</div>
        <div id="bodySn" class="value">—</div>
        <div id="bodyWarn" class="warn"></div>
      </div>
      <details class="help">
        <summary>抽出ルール</summary>
        <ul>
          <li><code>SN:00000000</code> の形式（SNは大文字、コロンあり）</li>
          <li>数字の桁数は設定で変更できます（初期値：8桁）</li>
        </ul>
      </details>
    </section>

    <section class="card">
      <h2>2) 基板番号を撮影（PCB）</h2>
      <div class="row">
        <button id="btnCapturePcb" class="btn primary">📷 基板を撮影</button>
        <button id="btnClearPcb" class="btn">クリア</button>
      </div>
      <div class="result">
        <div class="label">抽出結果</div>
        <div id="pcbId" class="value">—</div>
        <div id="pcbWarn" class="warn"></div>
      </div>
      <details class="help">
        <summary>抽出ルール</summary>
        <ul>
          <li>例：<code>PCB-2503-0123</code>（英大文字＋数字＋ハイフン推奨）</li>
          <li>基板屋さんの表記に合わせてパターンを調整できます</li>
        </ul>
      </details>
    </section>

    <section class="card">
      <h2>3) 保存</h2>
      <div class="grid2">
        <label class="field">
          <span>作業区分</span>
          <select id="workType">
            <option value="組立">組立</option>
            <option value="検査">検査</option>
            <option value="基板交換">基板交換</option>
            <option value="修理">修理</option>
            <option value="その他">その他</option>
          </select>
        </label>
        <label class="field">
          <span>作業者</span>
          <input id="operator" type="text" placeholder="例：山田" autocomplete="name" />
        </label>
      </div>

      <label class="field">
        <span>備考（任意）</span>
        <input id="note" type="text" placeholder="例：外観OK" />
      </label>

      <div class="row">
        <button id="btnSave" class="btn primary" disabled>✅ 保存（紐づけ完了）</button>
        <button id="btnResetAll" class="btn">全リセット</button>
      </div>

      <div id="saveStatus" class="status"></div>

      <details class="help">
        <summary>保存先</summary>
        <p>
          既定では Google Apps Script（GAS）へPOSTしてスプレッドシートに追記します。<br/>
          <strong>GASのURL（Webhook）を設定</strong>すると動作します。
        </p>
      </details>
    </section>

    <section class="card">
      <h2>カメラ</h2>
      <div class="camWrap">
        <video id="video" playsinline></video>
        <canvas id="canvas" class="hidden"></canvas>
      </div>
      <div class="row">
        <button id="btnStartCam" class="btn">▶ カメラ開始</button>
        <button id="btnStopCam" class="btn">■ カメラ停止</button>
      </div>
      <div class="row small">
        <label class="field inline">
          <span>解像度</span>
          <select id="resolution">
            <option value="1280x720">1280×720（推奨）</option>
            <option value="1920x1080">1920×1080（高精細）</option>
            <option value="640x480">640×480（軽量）</option>
          </select>
        </label>
        <label class="field inline">
          <span>フラッシュ</span>
          <button id="btnTorch" class="btn" disabled>💡 ON/OFF</button>
        </label>
      </div>
    </section>

    <section class="card">
      <h2>設定</h2>
      <div class="grid2">
        <label class="field">
          <span>SN桁数</span>
          <input id="snDigits" type="number" min="4" max="20" value="8"/>
        </label>
        <label class="field">
          <span>GAS Webhook URL</span>
          <input id="gasUrl" type="url" placeholder="https://script.google.com/macros/s/AKfycbwC8J8AflaFWFcnMg6uubzeUCIjsJ2Dz8c-VAErYnERTSvPlaLUyYK10uP5ZlVDXTG9/exec" />
        </label>
      </div>
      <div class="row">
        <button id="btnSaveSettings" class="btn">保存</button>
      </div>
      <p class="tiny">
        ※設定は端末内（LocalStorage）に保存されます。
      </p>
    </section>

    <footer class="footer">
      <p class="tiny">© AIRSERVE.Co.,Ltd. / 製造番号紐づけツール（プロトタイプ）</p>
    </footer>
  </main>

  <!-- Tesseract.js (OCR) -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
